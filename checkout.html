---
layout: default
title: Finaliser la Commande
---

<div class="checkout-page">
  <div class="checkout-container">
    <!-- Progress Steps -->
    <div class="checkout-steps">
      <div class="step active">
        <div class="step-number">1</div>
        <div class="step-label">Panier</div>
      </div>
      <div class="step-line"></div>
      <div class="step active">
        <div class="step-number">2</div>
        <div class="step-label">Informations</div>
      </div>
      <div class="step-line"></div>
      <div class="step">
        <div class="step-number">3</div>
        <div class="step-label">Confirmation</div>
      </div>
    </div>

    <div class="checkout-content">
      <!-- Left Column: Forms -->
      <div class="checkout-forms">
        <form id="checkoutForm" onsubmit="submitCheckout(event)">
          <!-- Customer Information -->
          <div class="form-section">
            <h2>üìã Informations de Livraison</h2>

            <div class="form-row">
              <div class="form-group">
                <label for="customerName">Nom complet *</label>
                <input
                  type="text"
                  id="customerName"
                  name="name"
                  required
                  placeholder="Ex: Jean Baptiste"
                  pattern="[A-Za-z√Ä-√ø\s]{3,50}"
                  title="Entrez votre nom complet">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="customerPhone">Num√©ro de t√©l√©phone *</label>
                <input
                  type="tel"
                  id="customerPhone"
                  name="phone"
                  required
                  placeholder="Ex: 5094886-8964"
                  pattern="[0-9\-\s]{8,15}"
                  title="Entrez un num√©ro valide">
              </div>

              <div class="form-group">
                <label for="customerEmail">Email (optionnel)</label>
                <input
                  type="email"
                  id="customerEmail"
                  name="email"
                  placeholder="exemple@email.com">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group full-width">
                <label for="customerAddress">Adresse de livraison *</label>
                <input
                  type="text"
                  id="customerAddress"
                  name="address"
                  required
                  placeholder="Ex: 123 Rue Lamartini√®re, Bois Verna">
              </div>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="customerCity">Ville/Commune *</label>
                <select id="customerCity" name="city" required>
                  <option value="">-- Choisir --</option>
                  <optgroup label="Aire M√©tropolitaine">
                    <option value="Port-au-Prince">Port-au-Prince</option>
                    <option value="Delmas">Delmas</option>
                    <option value="P√©tion-Ville">P√©tion-Ville</option>
                    <option value="Carrefour">Carrefour</option>
                    <option value="Tabarre">Tabarre</option>
                  </optgroup>
                  <optgroup label="Artibonite">
                    <option value="Gona√Øves">Gona√Øves</option>
                    <option value="Saint-Marc">Saint-Marc</option>
                  </optgroup>
                  <optgroup label="Nord">
                    <option value="Cap-Ha√Øtien">Cap-Ha√Øtien</option>
                  </optgroup>
                  <optgroup label="Sud">
                    <option value="Les Cayes">Les Cayes</option>
                    <option value="Jacmel">Jacmel</option>
                  </optgroup>
                  <optgroup label="Ouest">
                    <option value="L√©og√¢ne">L√©og√¢ne</option>
                    <option value="Croix-des-Bouquets">Croix-des-Bouquets</option>
                  </optgroup>
                </select>
              </div>

              <div class="form-group">
                <label for="deliveryTime">Moment pr√©f√©r√©</label>
                <select id="deliveryTime" name="delivery_time">
                  <option value="any">N'importe quand</option>
                  <option value="morning">Matin (8h-12h)</option>
                  <option value="afternoon">Apr√®s-midi (12h-17h)</option>
                  <option value="evening">Soir (17h-20h)</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group full-width">
                <label for="orderNotes">Notes suppl√©mentaires (optionnel)</label>
                <textarea
                  id="orderNotes"
                  name="notes"
                  rows="3"
                  placeholder="Instructions sp√©ciales pour la livraison..."></textarea>
              </div>
            </div>
          </div>

          <!-- Payment Method -->
          <div class="form-section">
            <h2>üí≥ Mode de Paiement</h2>

            <div class="payment-methods">
              <label class="payment-option">
                <input type="radio" name="payment_method" value="moncash" required>
                <div class="payment-card">
                  <div class="payment-icon">üí∏</div>
                  <div class="payment-info">
                    <strong>Moncash</strong>
                    <p>Num√©ro: <strong>4886-8964</strong></p>
                  </div>
                </div>
              </label>

              <label class="payment-option">
                <input type="radio" name="payment_method" value="natcash" required>
                <div class="payment-card">
                  <div class="payment-icon">üí≥</div>
                  <div class="payment-info">
                    <strong>Natcash</strong>
                    <p>Num√©ro: <strong>4068-3108</strong></p>
                  </div>
                </div>
              </label>

              <label class="payment-option">
                <input type="radio" name="payment_method" value="cash" required>
                <div class="payment-card">
                  <div class="payment-icon">üíµ</div>
                  <div class="payment-info">
                    <strong>Esp√®ces</strong>
                    <p>Paiement √† la livraison</p>
                  </div>
                </div>
              </label>
            </div>

            <div class="payment-instructions" id="paymentInstructions" style="display: none;">
              <div class="alert-info">
                <strong>üì± Instructions:</strong>
                <p id="instructionText"></p>
              </div>
            </div>
          </div>

          <!-- Terms and Conditions -->
          <div class="form-section">
            <label class="checkbox-label">
              <input type="checkbox" id="acceptTerms" required>
              <span>J'accepte les <a href="/conditions" target="_blank">conditions g√©n√©rales</a> et la <a href="/politique" target="_blank">politique de confidentialit√©</a></span>
            </label>
          </div>

          <!-- Submit Buttons -->
          <div class="form-actions">
            <a href="/cart" class="btn-secondary">
              ‚Üê Retour au panier
            </a>
            <button type="submit" class="btn-primary" id="submitOrderBtn">
              Confirmer la commande ‚Üí
            </button>
          </div>
        </form>
      </div>

      <!-- Right Column: Order Summary -->
      <div class="order-summary">
        <div class="summary-card">
          <h3>üì¶ R√©sum√© de la Commande</h3>

          <div id="checkoutItems" class="checkout-items"></div>

          <div class="summary-row">
            <span>Sous-total</span>
            <span id="checkoutSubtotal">0 HTG</span>
          </div>

          <div class="summary-row">
            <span>Livraison</span>
            <span id="checkoutShipping">0 HTG</span>
          </div>

          <div class="summary-row total">
            <strong>Total</strong>
            <strong id="checkoutTotal">0 HTG</strong>
          </div>

          <div class="promo-code-section">
            <input type="text" placeholder="Code promo" id="promoCode">
            <button onclick="applyPromoCode()">Appliquer</button>
          </div>

          <div class="trust-badges">
            <div class="badge">üõ°Ô∏è Paiement s√©curis√©</div>
            <div class="badge">‚úÖ Livraison rapide</div>
            <div class="badge">üìû Support 24/7</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.checkout-page {
  background: #f9fafb;
  min-height: 100vh;
  padding: 40px 20px;
}

.checkout-container {
  max-width: 1200px;
  margin: 0 auto;
}

.checkout-steps {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: 40px;
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 10px;
}

.step-number {
  width: 50px;
  height: 50px;
  border-radius: 50%;
  background: #e5e7eb;
  color: #9ca3af;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 18px;
  transition: all 0.3s;
}

.step.active .step-number {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
}

.step-label {
  font-size: 14px;
  color: #6b7280;
  font-weight: 500;
}

.step.active .step-label {
  color: #4facfe;
}

.step-line {
  width: 100px;
  height: 2px;
  background: #e5e7eb;
  margin: 0 20px;
}

.checkout-content {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 30px;
}

.checkout-forms {
  background: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.form-section {
  margin-bottom: 35px;
}

.form-section h2 {
  font-size: 24px;
  margin-bottom: 20px;
  color: #111827;
}

.form-row {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 20px;
}

.form-group {
  display: flex;
  flex-direction: column;
}

.form-group.full-width {
  grid-column: 1 / -1;
}

.form-group label {
  margin-bottom: 8px;
  font-weight: 500;
  color: #374151;
  font-size: 14px;
}

.form-group input,
.form-group select,
.form-group textarea {
  padding: 12px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
  font-size: 15px;
  transition: all 0.3s;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
  outline: none;
  border-color: #4facfe;
  box-shadow: 0 0 0 4px rgba(79, 172, 254, 0.1);
}

.form-group input:invalid:not(:placeholder-shown) {
  border-color: #ef4444;
}

.payment-methods {
  display: grid;
  gap: 15px;
}

.payment-option {
  cursor: pointer;
}

.payment-option input[type="radio"] {
  display: none;
}

.payment-card {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 20px;
  border: 2px solid #e5e7eb;
  border-radius: 12px;
  transition: all 0.3s;
}

.payment-option input:checked + .payment-card {
  border-color: #4facfe;
  background: #eff6ff;
}

.payment-icon {
  font-size: 32px;
}

.payment-info strong {
  display: block;
  margin-bottom: 5px;
  color: #111827;
}

.payment-info p {
  margin: 0;
  font-size: 14px;
  color: #6b7280;
}

.alert-info {
  padding: 15px;
  background: #dbeafe;
  border-left: 4px solid #3b82f6;
  border-radius: 8px;
  margin-top: 20px;
}

.alert-info strong {
  display: block;
  margin-bottom: 8px;
  color: #1e40af;
}

.alert-info p {
  margin: 0;
  color: #1e3a8a;
}

.checkbox-label {
  display: flex;
  align-items: center;
  gap: 10px;
  cursor: pointer;
}

.checkbox-label input {
  width: 20px;
  height: 20px;
  cursor: pointer;
}

.checkbox-label a {
  color: #4facfe;
  text-decoration: underline;
}

.form-actions {
  display: flex;
  gap: 15px;
  justify-content: space-between;
  margin-top: 30px;
}

.btn-primary,
.btn-secondary {
  flex: 1;
  padding: 15px 30px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
  text-decoration: none;
  text-align: center;
}

.btn-primary {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  color: white;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 10px 25px rgba(79, 172, 254, 0.3);
}

.btn-secondary {
  background: #f3f4f6;
  color: #374151;
}

.btn-secondary:hover {
  background: #e5e7eb;
}

.order-summary {
  position: sticky;
  top: 20px;
  height: fit-content;
}

.summary-card {
  background: white;
  padding: 25px;
  border-radius: 15px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
}

.summary-card h3 {
  font-size: 20px;
  margin-bottom: 20px;
  color: #111827;
}

.checkout-items {
  max-height: 300px;
  overflow-y: auto;
  margin-bottom: 20px;
  padding-right: 10px;
}

.checkout-item {
  display: flex;
  gap: 12px;
  padding: 12px 0;
  border-bottom: 1px solid #e5e7eb;
}

.checkout-item:last-child {
  border-bottom: none;
}

.checkout-item img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
}

.checkout-item-info {
  flex: 1;
}

.checkout-item-title {
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 5px;
}

.checkout-item-qty {
  font-size: 12px;
  color: #6b7280;
}

.checkout-item-price {
  font-weight: bold;
  color: #4facfe;
  text-align: right;
}

.summary-row {
  display: flex;
  justify-content: space-between;
  padding: 12px 0;
  border-top: 1px solid #e5e7eb;
}

.summary-row.total {
  font-size: 20px;
  color: #4facfe;
  padding-top: 15px;
  border-top: 2px solid #e5e7eb;
}

.promo-code-section {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.promo-code-section input {
  flex: 1;
  padding: 10px;
  border: 2px solid #e5e7eb;
  border-radius: 8px;
}

.promo-code-section button {
  padding: 10px 20px;
  background: #f3f4f6;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 500;
}

.trust-badges {
  display: grid;
  gap: 10px;
  margin-top: 20px;
  padding-top: 20px;
  border-top: 1px solid #e5e7eb;
}

.badge {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: #6b7280;
}

@media (max-width: 968px) {
  .checkout-content {
    grid-template-columns: 1fr;
  }

  .order-summary {
    position: static;
  }

  .checkout-steps {
    padding: 20px;
  }

  .step-line {
    width: 50px;
    margin: 0 10px;
  }

  .step-label {
    display: none;
  }
}

@media (max-width: 640px) {
  .form-actions {
    flex-direction: column;
  }
}
</style>

<script>
// Load cart items on page load
document.addEventListener('DOMContentLoaded', function() {
  loadCheckoutSummary();
  setupPaymentInstructions();
});

function loadCheckoutSummary() {
  const cart = JSON.parse(localStorage.getItem('boutique_piyay_cart') || '[]');

  if (cart.length === 0) {
    window.location.href = '/cart';
    return;
  }

  // Render items
  const container = document.getElementById('checkoutItems');
  container.innerHTML = cart.map(item => `
    <div class="checkout-item">
      <img src="${item.image}" alt="${item.title}">
      <div class="checkout-item-info">
        <div class="checkout-item-title">${item.title}</div>
        <div class="checkout-item-qty">Quantit√©: ${item.quantity}</div>
      </div>
      <div class="checkout-item-price">${item.price * item.quantity} HTG</div>
    </div>
  `).join('');

  // Calculate totals
  const subtotal = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
  const shipping = subtotal >= 1000 ? 0 : 100;
  const total = subtotal + shipping;

  document.getElementById('checkoutSubtotal').textContent = `${subtotal} HTG`;
  document.getElementById('checkoutShipping').textContent =
    shipping === 0 ? 'GRATUIT ‚úÖ' : `${shipping} HTG`;
  document.getElementById('checkoutTotal').textContent = `${total} HTG`;
}

function setupPaymentInstructions() {
  const radios = document.querySelectorAll('input[name="payment_method"]');
  const instructions = document.getElementById('paymentInstructions');
  const instructionText = document.getElementById('instructionText');

  radios.forEach(radio => {
    radio.addEventListener('change', function() {
      instructions.style.display = 'block';

      switch(this.value) {
        case 'moncash':
          instructionText.innerHTML = `
            1. Ouvrez votre application Moncash<br>
            2. Envoyez le montant total au <strong>4886-8964</strong><br>
            3. Gardez votre re√ßu de transaction
          `;
          break;
        case 'natcash':
          instructionText.innerHTML = `
            1. Ouvrez votre application Natcash<br>
            2. Envoyez le montant total au <strong>4068-3108</strong><br>
            3. Gardez votre re√ßu de transaction
          `;
          break;
        case 'cash':
          instructionText.innerHTML = `
            Pr√©parez le montant exact pour faciliter la livraison.<br>
            Le livreur vous contactera avant d'arriver.
          `;
          instructions.style.display = 'block';
          break;
      }
    });
  });
}

function submitCheckout(e) {
  e.preventDefault();

  const formData = new FormData(e.target);
  const btn = document.getElementById('submitOrderBtn');

  // Disable button and show loading
  btn.disabled = true;
  btn.textContent = '‚è≥ Traitement en cours...';

  // Process checkout (this will be handled by cart.js)
  setTimeout(() => {
    if (typeof cart !== 'undefined') {
      cart.processCheckout(formData);
    } else {
      // Fallback if cart.js not loaded
      alert('Erreur: Syst√®me de panier non charg√©');
      btn.disabled = false;
      btn.textContent = 'Confirmer la commande ‚Üí';
    }
  }, 1000);
}

function applyPromoCode() {
  const code = document.getElementById('promoCode').value.trim().toUpperCase();

  const validCodes = {
    'BIENVENUE10': 10, // 10% off
    'PIYAY2026': 50,   // 50 HTG off
    'FIRST20': 20      // 20% off
  };

  if (validCodes[code]) {
    alert(`‚úÖ Code promo appliqu√©! R√©duction: ${validCodes[code]}${code.includes('10') || code.includes('20') ? '%' : ' HTG'}`);
    // Apply discount logic here
  } else if (code) {
    alert('‚ùå Code promo invalide');
  }
}
</script>