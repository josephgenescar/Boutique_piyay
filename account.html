---
layout: default
title: "Kont Mwen - Boutique Piyay"
permalink: /account/
---

<style>
  @import url('https://fonts.googleapis.com/css2?family=Sora:wght@400;600;700;800&family=DM+Sans:wght@400;500;600&display=swap');

  :root {
    --orange: #FF5722;
    --orange-light: #FF7043;
    --orange-pale: #FFF3EF;
    --navy: #0D1B2A;
    --gold: #FFB300;
    --green: #00C853;
    --red: #F44336;
    --gray-100: #F8F9FA;
    --gray-200: #EAEDF0;
    --gray-500: #8A94A6;
    --gray-700: #4A5568;
    --radius: 16px;
    --radius-sm: 10px;
    --shadow-sm: 0 1px 4px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
  }

  * { box-sizing: border-box; }
  body { font-family: 'DM Sans', sans-serif; background: #F4F5F7; color: var(--navy); min-height: 100vh; }

  /* ========== AUTH SCREEN ========== */
  .auth-wrapper {
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 30px 16px;
  }
  .auth-card {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow-md);
    padding: 40px;
    width: 100%;
    max-width: 440px;
    animation: slideUp 0.4s cubic-bezier(0.34,1.56,0.64,1);
  }
  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  .auth-logo {
    text-align: center;
    margin-bottom: 28px;
  }
  .auth-logo .brand {
    font-family: 'Sora', sans-serif;
    font-size: 1.6rem;
    font-weight: 800;
    color: var(--navy);
  }
  .auth-logo .brand span { color: var(--orange); }
  .auth-logo .tagline { font-size: 0.85rem; color: var(--gray-500); margin-top: 4px; }

  .auth-tabs {
    display: flex;
    background: var(--gray-100);
    border-radius: var(--radius-sm);
    padding: 4px;
    margin-bottom: 24px;
  }
  .auth-tab {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 8px;
    font-family: 'Sora', sans-serif;
    font-size: 0.88rem;
    font-weight: 700;
    cursor: pointer;
    background: transparent;
    color: var(--gray-500);
    transition: all 0.2s;
  }
  .auth-tab.active {
    background: white;
    color: var(--navy);
    box-shadow: var(--shadow-sm);
  }

  .auth-panel { display: none; }
  .auth-panel.active { display: block; animation: fadeIn 0.25s; }
  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

  .form-group { margin-bottom: 14px; }
  .form-label {
    display: block;
    font-size: 0.82rem;
    font-weight: 600;
    color: var(--gray-700);
    margin-bottom: 6px;
  }
  .form-input {
    width: 100%;
    padding: 12px 14px;
    border: 2px solid var(--gray-200);
    border-radius: var(--radius-sm);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.92rem;
    outline: none;
    transition: border-color 0.2s;
    background: white;
    color: var(--navy);
  }
  .form-input:focus { border-color: var(--orange); }
  .form-input.error { border-color: var(--red); }

  .form-error {
    font-size: 0.78rem;
    color: var(--red);
    margin-top: 4px;
    display: none;
  }

  .btn-auth {
    width: 100%;
    padding: 14px;
    background: var(--orange);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-family: 'Sora', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 6px;
  }
  .btn-auth:hover { background: var(--orange-light); transform: translateY(-1px); }
  .btn-auth:disabled { background: var(--gray-500); cursor: not-allowed; transform: none; }

  .auth-divider {
    text-align: center;
    position: relative;
    margin: 18px 0;
    color: var(--gray-500);
    font-size: 0.8rem;
  }
  .auth-divider::before, .auth-divider::after {
    content: '';
    position: absolute;
    top: 50%;
    width: 42%;
    height: 1px;
    background: var(--gray-200);
  }
  .auth-divider::before { left: 0; }
  .auth-divider::after { right: 0; }

  .forgot-link {
    text-align: right;
    margin-top: -8px;
    margin-bottom: 12px;
  }
  .forgot-link a {
    font-size: 0.8rem;
    color: var(--orange);
    text-decoration: none;
    font-weight: 600;
  }

  /* ========== DASHBOARD ========== */
  .dashboard {
    max-width: 1200px;
    margin: 0 auto;
    padding: 24px 16px;
  }

  /* Welcome bar */
  .welcome-bar {
    background: linear-gradient(135deg, var(--navy) 0%, #1E3A5F 100%);
    border-radius: var(--radius);
    padding: 24px 28px;
    display: flex;
    align-items: center;
    gap: 20px;
    margin-bottom: 24px;
    position: relative;
    overflow: hidden;
  }
  .welcome-bar::before {
    content: 'üõçÔ∏è';
    position: absolute;
    right: 24px;
    font-size: 4rem;
    opacity: 0.15;
  }
  .user-avatar-big {
    width: 56px; height: 56px;
    border-radius: 50%;
    background: var(--orange);
    color: white;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Sora', sans-serif;
    font-size: 1.4rem;
    font-weight: 800;
    flex-shrink: 0;
    border: 3px solid rgba(255,255,255,0.3);
  }
  .welcome-text { flex: 1; }
  .welcome-text h2 {
    font-family: 'Sora', sans-serif;
    font-size: 1.2rem;
    font-weight: 800;
    color: white;
    margin-bottom: 4px;
  }
  .welcome-text p { font-size: 0.85rem; color: rgba(255,255,255,0.6); }
  .logout-btn {
    padding: 8px 18px;
    background: rgba(255,255,255,0.15);
    color: white;
    border: 1.5px solid rgba(255,255,255,0.25);
    border-radius: 100px;
    font-family: 'Sora', sans-serif;
    font-size: 0.82rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    backdrop-filter: blur(4px);
  }
  .logout-btn:hover { background: rgba(255,255,255,0.25); }

  /* Stats */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 14px;
    margin-bottom: 24px;
  }
  .stat-card {
    background: white;
    border-radius: var(--radius-sm);
    padding: 18px;
    box-shadow: var(--shadow-sm);
    text-align: center;
    transition: transform 0.2s;
  }
  .stat-card:hover { transform: translateY(-2px); }
  .stat-icon { font-size: 1.6rem; margin-bottom: 6px; }
  .stat-num {
    font-family: 'Sora', sans-serif;
    font-size: 1.6rem;
    font-weight: 800;
    color: var(--orange);
    line-height: 1;
    margin-bottom: 4px;
  }
  .stat-label { font-size: 0.78rem; color: var(--gray-500); font-weight: 500; }

  /* Dashboard grid */
  .dash-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  /* Panel */
  .dash-panel {
    background: white;
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
  }
  .dash-panel.full { grid-column: 1/-1; }
  .panel-header {
    padding: 16px 20px;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .panel-title {
    font-family: 'Sora', sans-serif;
    font-size: 0.95rem;
    font-weight: 700;
    color: var(--navy);
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .panel-link {
    font-size: 0.8rem;
    color: var(--orange);
    text-decoration: none;
    font-weight: 600;
  }

  /* Order list */
  .order-item {
    padding: 14px 20px;
    border-bottom: 1px solid var(--gray-200);
    display: flex;
    align-items: center;
    gap: 12px;
    transition: background 0.15s;
  }
  .order-item:last-child { border-bottom: none; }
  .order-item:hover { background: var(--gray-100); }
  .order-thumb {
    width: 44px; height: 44px;
    border-radius: 8px;
    object-fit: cover;
    background: var(--gray-100);
    flex-shrink: 0;
  }
  .order-info { flex: 1; min-width: 0; }
  .order-title {
    font-weight: 600;
    font-size: 0.88rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .order-date { font-size: 0.75rem; color: var(--gray-500); }
  .order-price {
    font-family: 'Sora', sans-serif;
    font-weight: 700;
    color: var(--orange);
    font-size: 0.9rem;
    white-space: nowrap;
  }
  .order-status {
    font-size: 0.72rem;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 100px;
  }
  .status-pending { background: #FFF3E0; color: #E65100; }
  .status-confirmed { background: #E8F5E9; color: var(--green); }
  .status-delivered { background: #E3F2FD; color: #1565C0; }
  .status-cancelled { background: #FFEBEE; color: var(--red); }

  .empty-state {
    padding: 30px;
    text-align: center;
    color: var(--gray-500);
    font-size: 0.88rem;
  }
  .empty-state .emoji { font-size: 2.5rem; margin-bottom: 8px; }

  /* Wishlist */
  .wish-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    padding: 16px;
  }
  .wish-card {
    border-radius: var(--radius-sm);
    overflow: hidden;
    border: 1.5px solid var(--gray-200);
    cursor: pointer;
    transition: all 0.2s;
    text-decoration: none;
    color: inherit;
  }
  .wish-card:hover { border-color: var(--orange); transform: scale(1.02); }
  .wish-img { aspect-ratio: 1; background: var(--gray-100); overflow: hidden; }
  .wish-img img { width: 100%; height: 100%; object-fit: cover; }
  .wish-name { padding: 8px; font-size: 0.78rem; font-weight: 600; line-height: 1.3; }

  /* Profile form */
  .profile-form { padding: 20px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .save-btn {
    padding: 11px 24px;
    background: var(--orange);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-family: 'Sora', sans-serif;
    font-size: 0.88rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    margin-top: 8px;
  }
  .save-btn:hover { background: var(--orange-light); }

  /* ========== RESPONSIVE ========== */
  @media (max-width: 860px) {
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .dash-grid { grid-template-columns: 1fr; }
  }
  @media (max-width: 520px) {
    .auth-card { padding: 24px 20px; }
    .stats-grid { grid-template-columns: repeat(2, 1fr); }
    .wish-grid { grid-template-columns: repeat(2, 1fr); }
    .form-row { grid-template-columns: 1fr; }
  }
</style>

<!-- AUTH SCREEN (hidden when logged in) -->
<div id="authScreen">
  <div class="auth-wrapper">
    <div class="auth-card">
      <div class="auth-logo">
        <div class="brand">Boutique <span>Piyay</span></div>
        <div class="tagline">Konekte pou jwenn aks√® nan kont ou</div>
      </div>

      <div class="auth-tabs">
        <button class="auth-tab active" onclick="switchAuthTab('login')">üîë Konekte</button>
        <button class="auth-tab" onclick="switchAuthTab('register')">üÜï Kreye Kont</button>
      </div>

      <!-- Login Panel -->
      <div class="auth-panel active" id="loginPanel">
        <div class="form-group">
          <label class="form-label">üìß Adr√®s Email</label>
          <input class="form-input" id="loginEmail" type="email" placeholder="ou@email.com" autocomplete="email">
          <div class="form-error" id="loginEmailErr">Email envalid</div>
        </div>
        <div class="form-group">
          <label class="form-label">üîí Modpas</label>
          <input class="form-input" id="loginPwd" type="password" placeholder="Modpas ou..." autocomplete="current-password">
          <div class="form-error" id="loginPwdErr">Modpas envalid</div>
        </div>
        <div class="forgot-link"><a href="#" onclick="forgotPassword()">Bliye modpas ou?</a></div>
        <button class="btn-auth" onclick="handleLogin()" id="loginBtn">üîë Konekte</button>
        <div class="auth-divider">oubyen</div>
        <button class="btn-auth" style="background:var(--navy)" onclick="loginWithGoogle()">
          <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" alt="G">
          Konekte ak Google
        </button>
      </div>

      <!-- Register Panel -->
      <div class="auth-panel" id="registerPanel">
        <div class="form-group">
          <label class="form-label">üë§ Non Konpl√®</label>
          <input class="form-input" id="regName" type="text" placeholder="Non ak Prenon" autocomplete="name">
        </div>
        <div class="form-group">
          <label class="form-label">üìß Adr√®s Email</label>
          <input class="form-input" id="regEmail" type="email" placeholder="ou@email.com" autocomplete="email">
        </div>
        <div class="form-group">
          <label class="form-label">üì± Nimewo WhatsApp</label>
          <input class="form-input" id="regPhone" type="tel" placeholder="+509 XXXX XXXX">
        </div>
        <div class="form-group">
          <label class="form-label">üîí Modpas</label>
          <input class="form-input" id="regPwd" type="password" placeholder="Modpas (min. 8 karakt√®)">
        </div>
        <button class="btn-auth" onclick="handleRegister()" id="regBtn">üöÄ Kreye Kont</button>
      </div>

      <div id="authMsg" style="margin-top:14px;padding:10px 14px;border-radius:8px;font-size:0.85rem;font-weight:600;display:none;"></div>
    </div>
  </div>
</div>

<!-- DASHBOARD (shown when logged in) -->
<div id="dashboard" style="display:none;">
  <div class="dashboard">

    <!-- Welcome -->
    <div class="welcome-bar">
      <div class="user-avatar-big" id="userAvatar">?</div>
      <div class="welcome-text">
        <h2>Bonjou, <span id="userName">Kliyan</span>! üëã</h2>
        <p id="userEmail">kliyan@email.com</p>
      </div>
      <button class="logout-btn" onclick="handleLogout()">üö™ Dekonekte</button>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">üì¶</div>
        <div class="stat-num" id="statOrders">0</div>
        <div class="stat-label">K√≤mand Total</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚ù§Ô∏è</div>
        <div class="stat-num" id="statWish">0</div>
        <div class="stat-label">Wishlist</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">üí∞</div>
        <div class="stat-num" id="statSpent">0</div>
        <div class="stat-label">HTG Depanse</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">‚≠ê</div>
        <div class="stat-num" id="statReviews">0</div>
        <div class="stat-label">Evaliyasyon</div>
      </div>
    </div>

    <!-- Grid -->
    <div class="dash-grid">

      <!-- Orders -->
      <div class="dash-panel">
        <div class="panel-header">
          <span class="panel-title">üì¶ D√®nye K√≤mand</span>
          <a href="{{ site.baseurl }}/shop/" class="panel-link">+ Nouvo k√≤mand</a>
        </div>
        <div id="ordersList">
          <div class="empty-state">
            <div class="emoji">üì≠</div>
            <div>Okenn k√≤mand poko.</div>
            <a href="{{ site.baseurl }}/shop/" style="color:var(--orange);font-weight:700;font-size:0.85rem;">K√≤manse achte ‚Üí</a>
          </div>
        </div>
      </div>

      <!-- Wishlist -->
      <div class="dash-panel">
        <div class="panel-header">
          <span class="panel-title">‚ù§Ô∏è Wishlist Mwen</span>
          <span class="panel-link" style="cursor:pointer" onclick="clearWishlist()">Efase tout</span>
        </div>
        <div id="wishlistGrid" class="wish-grid">
          <div class="empty-state" style="grid-column:1/-1">
            <div class="emoji">ü§ç</div>
            <div>Wishlist ou vid.</div>
          </div>
        </div>
      </div>

      <!-- Cart summary -->
      <div class="dash-panel">
        <div class="panel-header">
          <span class="panel-title">üõí Panier Akty√®l</span>
          <a href="{{ site.baseurl }}/checkout/" class="panel-link">Peye kounye ‚Üí</a>
        </div>
        <div id="cartSummary">
          <div class="empty-state">
            <div class="emoji">üõí</div>
            <div>Panier ou vid.</div>
          </div>
        </div>
      </div>

      <!-- Profile -->
      <div class="dash-panel">
        <div class="panel-header">
          <span class="panel-title">üë§ Pwofil Mwen</span>
        </div>
        <div class="profile-form">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Non</label>
              <input class="form-input" id="profileName" type="text">
            </div>
            <div class="form-group">
              <label class="form-label">Telef√≤n</label>
              <input class="form-input" id="profilePhone" type="tel">
            </div>
          </div>
          <div class="form-group">
            <label class="form-label">Adr√®s Livrezon</label>
            <input class="form-input" id="profileAddress" type="text" placeholder="Vil, Katye...">
          </div>
          <div class="form-group">
            <label class="form-label">Nimewo MonCash / NatCash</label>
            <input class="form-input" id="profileMoncash" type="tel" placeholder="+509 XXXX XXXX">
          </div>
          <button class="save-btn" onclick="saveProfile()">üíæ Sove Chanjman</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ============ SIMPLE LOCAL AUTH (no Netlify Identity needed) ============
// Uses localStorage for demo ‚Äî replace with Netlify Identity for production

const AUTH_KEY = 'piyay_user';
const ORDERS_KEY = 'piyay_orders';

// ============ TABS ============
function switchAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach((t, i) => {
    t.classList.toggle('active', (i === 0 && tab === 'login') || (i === 1 && tab === 'register'));
  });
  document.getElementById('loginPanel').classList.toggle('active', tab === 'login');
  document.getElementById('registerPanel').classList.toggle('active', tab === 'register');
  document.getElementById('authMsg').style.display = 'none';
}

// ============ REGISTER ============
function handleRegister() {
  const name = document.getElementById('regName').value.trim();
  const email = document.getElementById('regEmail').value.trim();
  const phone = document.getElementById('regPhone').value.trim();
  const pwd = document.getElementById('regPwd').value;

  if (!name || !email || !pwd) { showAuthMsg('‚ö†Ô∏è Ranpli tout chan obligatwa yo!', 'error'); return; }
  if (pwd.length < 8) { showAuthMsg('‚ö†Ô∏è Modpas dwe gen omwen 8 karakt√®!', 'error'); return; }

  const users = JSON.parse(localStorage.getItem('piyay_users') || '[]');
  if (users.find(u => u.email === email)) {
    showAuthMsg('‚ùå Email sa a deja egziste!', 'error'); return;
  }

  const user = { name, email, phone, pwd: btoa(pwd), address: '', moncash: '', joined: new Date().toISOString() };
  users.push(user);
  localStorage.setItem('piyay_users', JSON.stringify(users));
  localStorage.setItem(AUTH_KEY, JSON.stringify(user));

  showAuthMsg('‚úÖ Kont kreye! Byenveni ' + name + '!', 'success');
  setTimeout(() => { showDashboard(user); }, 1200);
}

// ============ LOGIN ============
function handleLogin() {
  const email = document.getElementById('loginEmail').value.trim();
  const pwd = document.getElementById('loginPwd').value;
  if (!email || !pwd) { showAuthMsg('‚ö†Ô∏è Ranpli email ak modpas!', 'error'); return; }

  const users = JSON.parse(localStorage.getItem('piyay_users') || '[]');
  const user = users.find(u => u.email === email && atob(u.pwd) === pwd);
  if (!user) { showAuthMsg('‚ùå Email oswa modpas pa k√≤r√®k!', 'error'); return; }

  localStorage.setItem(AUTH_KEY, JSON.stringify(user));
  showDashboard(user);
}

function loginWithGoogle() {
  showAuthMsg('üí° Google Login ap vini byento. Itilize email/modpas pou kounye a.', 'info');
}

function forgotPassword() {
  const email = document.getElementById('loginEmail').value.trim();
  if (!email) { showAuthMsg('‚ö†Ô∏è Antre email ou a anpremye.', 'error'); return; }
  showAuthMsg('üìß Enstriksyon reyinisyalizasyon voye sou ' + email + ' (demo mode)', 'success');
}

// ============ LOGOUT ============
function handleLogout() {
  localStorage.removeItem(AUTH_KEY);
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('authScreen').style.display = '';
}

// ============ SHOW DASHBOARD ============
function showDashboard(user) {
  document.getElementById('authScreen').style.display = 'none';
  document.getElementById('dashboard').style.display = '';

  // Fill user info
  const initial = (user.name || user.email || 'U').charAt(0).toUpperCase();
  document.getElementById('userAvatar').textContent = initial;
  document.getElementById('userName').textContent = user.name || 'Kliyan';
  document.getElementById('userEmail').textContent = user.email;

  // Profile form
  document.getElementById('profileName').value = user.name || '';
  document.getElementById('profilePhone').value = user.phone || '';
  document.getElementById('profileAddress').value = user.address || '';
  document.getElementById('profileMoncash').value = user.moncash || '';

  // Load data
  loadOrders();
  loadWishlist();
  loadCart();
}

// ============ ORDERS ============
function loadOrders() {
  const orders = JSON.parse(localStorage.getItem(ORDERS_KEY) || '[]');
  const user = JSON.parse(localStorage.getItem(AUTH_KEY) || '{}');
  const myOrders = orders.filter(o => o.email === user.email);

  document.getElementById('statOrders').textContent = myOrders.length;
  const spent = myOrders.reduce((s, o) => s + (o.total || 0), 0);
  document.getElementById('statSpent').textContent = spent > 1000 ? Math.round(spent/1000) + 'k' : spent;

  const list = document.getElementById('ordersList');
  if (myOrders.length === 0) {
    list.innerHTML = `<div class="empty-state">
      <div class="emoji">üì≠</div>
      <div>Okenn k√≤mand poko.</div>
      <a href="{{ site.baseurl }}/shop/" style="color:var(--orange);font-weight:700;font-size:0.85rem;">K√≤manse achte ‚Üí</a>
    </div>`;
    return;
  }
  list.innerHTML = myOrders.slice(-5).reverse().map(o => `
    <div class="order-item">
      <img class="order-thumb" src="${o.image || ''}" alt="${o.title || ''}"
           onerror="this.style.display='none'">
      <div class="order-info">
        <div class="order-title">${o.title || 'K√≤mand #' + o.id}</div>
        <div class="order-date">${new Date(o.date || Date.now()).toLocaleDateString('fr-HT', {day:'numeric', month:'short', year:'numeric'})}</div>
      </div>
      <div class="order-price">${(o.total || 0).toLocaleString()} HTG</div>
      <span class="order-status status-${o.status || 'pending'}">
        ${{ "{{ o.status === 'confirmed' ? '‚úÖ Konfime' : o.status === 'delivered' ? 'üöö Livre' : o.status === 'cancelled' ? '‚ùå Anile' : '‚è≥ Annatant' }}" }}
      </span>
    </div>
  `).join('');
}

// ============ WISHLIST ============
function loadWishlist() {
  const wish = JSON.parse(localStorage.getItem('piyay_wishlist') || '[]');
  document.getElementById('statWish').textContent = wish.length;
  const grid = document.getElementById('wishlistGrid');
  if (wish.length === 0) {
    grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1">
      <div class="emoji">ü§ç</div><div>Wishlist ou vid.</div>
    </div>`;
    return;
  }
  grid.innerHTML = wish.slice(0, 6).map(w => `
    <a class="wish-card" href="${w.url || '#'}">
      <div class="wish-img">
        <img src="${w.image || ''}" alt="${w.title}"
             onerror="this.parentElement.style.background='var(--gray-100)';this.style.display='none'">
      </div>
      <div class="wish-name">${w.title}</div>
    </a>
  `).join('');
}

function clearWishlist() {
  if (confirm('Efase tout wishlist?')) {
    localStorage.removeItem('piyay_wishlist');
    loadWishlist();
    document.getElementById('statWish').textContent = '0';
  }
}

// ============ CART ============
function loadCart() {
  const cart = JSON.parse(localStorage.getItem('piyay_cart') || '[]');
  const summary = document.getElementById('cartSummary');
  if (cart.length === 0) {
    summary.innerHTML = `<div class="empty-state">
      <div class="emoji">üõí</div><div>Panier ou vid.</div>
    </div>`;
    return;
  }
  const total = cart.reduce((s, i) => s + i.price * i.quantity, 0);
  summary.innerHTML = cart.map(i => `
    <div class="order-item">
      <img class="order-thumb" src="${i.image || ''}" alt="${i.title}"
           onerror="this.style.background='var(--gray-100)'">
      <div class="order-info">
        <div class="order-title">${i.title}</div>
        <div class="order-date">Kantite: ${i.quantity}</div>
      </div>
      <div class="order-price">${(i.price * i.quantity).toLocaleString()} HTG</div>
    </div>
  `).join('') +
  `<div style="padding:14px 20px;font-family:Sora,sans-serif;font-weight:700;color:var(--orange);font-size:1rem;border-top:1px solid var(--gray-200);display:flex;justify-content:space-between;">
    <span>Total:</span>
    <span>${total.toLocaleString()} HTG</span>
  </div>`;
}

// ============ PROFILE ============
function saveProfile() {
  const user = JSON.parse(localStorage.getItem(AUTH_KEY) || '{}');
  user.name = document.getElementById('profileName').value;
  user.phone = document.getElementById('profilePhone').value;
  user.address = document.getElementById('profileAddress').value;
  user.moncash = document.getElementById('profileMoncash').value;
  localStorage.setItem(AUTH_KEY, JSON.stringify(user));

  const users = JSON.parse(localStorage.getItem('piyay_users') || '[]');
  const idx = users.findIndex(u => u.email === user.email);
  if (idx >= 0) { users[idx] = user; localStorage.setItem('piyay_users', JSON.stringify(users)); }

  showToast('‚úÖ Pwofil ou sove!');
  document.getElementById('userName').textContent = user.name || 'Kliyan';
  document.getElementById('userAvatar').textContent = (user.name || user.email || 'U').charAt(0).toUpperCase();
}

// ============ AUTH MSG ============
function showAuthMsg(msg, type) {
  const el = document.getElementById('authMsg');
  el.textContent = msg;
  el.style.display = 'block';
  el.style.background = type === 'error' ? '#FFEBEE' : type === 'success' ? '#E8F5E9' : '#E3F2FD';
  el.style.color = type === 'error' ? 'var(--red)' : type === 'success' ? 'var(--green)' : '#1565C0';
}

// ============ TOAST ============
function showToast(msg) {
  let t = document.getElementById('accToast');
  if (!t) {
    t = document.createElement('div');
    t.id = 'accToast';
    t.style.cssText = 'position:fixed;bottom:20px;right:20px;background:#0D1B2A;color:white;padding:12px 20px;border-radius:10px;font-family:Sora,sans-serif;font-size:0.88rem;font-weight:600;z-index:99999;box-shadow:0 8px 24px rgba(0,0,0,0.3);transform:translateY(80px);opacity:0;transition:all 0.3s;';
    document.body.appendChild(t);
  }
  t.textContent = msg;
  t.style.transform = 'translateY(0)';
  t.style.opacity = '1';
  setTimeout(() => { t.style.transform = 'translateY(80px)'; t.style.opacity = '0'; }, 3000);
}

// ============ REVIEWS COUNT ============
function countUserReviews(email) {
  const allKeys = Object.keys(localStorage).filter(k => k.startsWith('reviews_'));
  let total = 0;
  allKeys.forEach(k => {
    const reviews = JSON.parse(localStorage.getItem(k) || '[]');
    // Count all reviews (no email tracking in this simple impl)
  });
  return total;
}

// ============ INIT ============
document.addEventListener('DOMContentLoaded', () => {
  const user = localStorage.getItem(AUTH_KEY);
  if (user) {
    showDashboard(JSON.parse(user));
  }

  // Enter key support
  document.getElementById('loginPwd').addEventListener('keydown', e => {
    if (e.key === 'Enter') handleLogin();
  });
  document.getElementById('regPwd').addEventListener('keydown', e => {
    if (e.key === 'Enter') handleRegister();
  });
});
</script>
